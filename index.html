<!DOCTYPE html>
<html>
<head>
    <title>dinglebob</title>
    <style>
        body { 
            font-family: monospace; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 20px; 
            line-height: 1.6;
        }
        h1 { margin-bottom: 10px; }
        .intro-text { margin-bottom: 20px; }
        .links { margin-bottom: 20px; }
        
        /* Cheat Sheet styling */
        .syntax-ref { 
            margin-bottom: 20px; 
            font-size: 13px;
        }
        .syntax-ref summary { 
            cursor: pointer; 
            font-weight: bold; 
            color: #333; 
        }
        .syntax-ref div { 
            background: #fff; 
            padding: 15px; 
            border: 1px solid #ccc; 
            margin-top: 10px; 
        }
        .syntax-ref code { 
            background: #f9f9f9; 
            padding: 2px 4px; 
            border-radius: 3px; 
        }

        .editor { 
            display: flex; 
            border: 1px solid black; 
            width: 100%; 
            height: 400px; 
        }
        #line-numbers { 
            width: 40px; 
            background: #eee; 
            text-align: right; 
            padding: 5px; 
            overflow: hidden; 
            font-size: 13px; 
            line-height: 1.5; 
            border-right: 1px solid #ccc;
        }
        textarea { 
            flex: 1; 
            border: none; 
            outline: none; 
            padding: 5px; 
            resize: none; 
            font-family: monospace; 
            font-size: 13px; 
            line-height: 1.5; 
        }
        button { 
            margin-top: 15px; 
            padding: 10px 20px; 
            cursor: pointer; 
            font-family: monospace;
        }
        #output-container { 
            display: none; 
            margin-top: 30px; 
        }
        #output { 
            width: 100%; 
            white-space: pre-wrap; 
            border-top: 1px solid #ccc;
            padding-top: 15px;
            font-size: 13px;
        }
    </style>
</head>
<body>

    <h1>DingleBob Interpreter</h1>

    <div class="intro-text">
        Welcome! This is a playground for the <strong>DingleBob</strong> language.
    </div>

    <div class="links">
        &raquo; <strong>Syntax Guide:</strong> <a href="https://github.com/poytaytoy/DingleBob/blob/main/SYNTAX.md" target="_blank">SYNTAX.md</a><br>
        &raquo; <strong>Repository:</strong> <a href="https://github.com/poytaytoy/DingleBob" target="_blank">github.com/poytaytoy/DingleBob</a>
    </div>

    <details class="syntax-ref" open>
        <summary>&raquo; Syntax Cheat Sheet</summary>
        <div>
            <strong>Comments:</strong> <code># this is a comment</code><br>

            <strong>Statements end with <code>;</code>:</strong>
            <code>let</code>, expression statements, <code>print</code>, <code>return</code>, <code>break</code><br><br>

            <strong>Variables:</strong> <code>let x = 10;</code> / <code>let y;</code> (sugar for <code>y = none;</code>)<br>
            <strong>Assignment:</strong> <code>x = x + 1;</code> / <code>xs[i] = 42;</code><br>
            <strong>Print:</strong> <code>print expr;</code><br>

            <strong>Blocks / Scope:</strong> <code>{ ... }</code><br>

            <strong>Conditionals:</strong> <code>if cond { ... } else { ... }</code><br>
            <strong>Loops:</strong>
            <ul>
                <li><code>while cond { ... }</code></li>
                <li><code>for ( init ; cond ; inc ) { ... }</code></li>
                <li><code>break;</code> (only inside loops)</li>
            </ul>

            <strong>Functions:</strong> <code>define add(a, b) { return a + b; }</code><br>
            <strong>Return:</strong> <code>return expr;</code> or <code>return;</code> (returns <code>none</code>)<br>
            <strong>Lambdas:</strong> <code>let f = lambda(x) { return x * x; };</code><br><br>

            <strong>Types & literals:</strong>
            <code>none</code>, <code>true</code>, <code>false</code>, numbers (<code>123</code>, <code>3.14</code>), strings (<code>"hello"</code>)<br>

            <strong>Lists:</strong> <code>let xs = [1, 2, 3];</code> / <code>[]</code> (Index: <code>xs[0]</code>)<br>
            <strong>Truthiness:</strong> <code>false</code>, <code>none</code>, <code>0</code>, <code>0.0</code> are false; everything else is true<br><br>

            <strong>Operators:</strong> <code>+ - * / %</code>, <code>&gt; &gt;= &lt; &lt;= == !=</code>, <code>and</code>, <code>or</code>, unary <code>!</code><br>

            <strong>Built-ins:</strong> <code>timeit()</code>, <code>abs(x)</code>, <code>len(xs)</code>, <code>copy(xs)</code>, <code>append(xs, v)</code>, <code>concat(a, b)</code><br>
            <strong>Imports:</strong> <code>import("file.dingle");</code>
        </div>
    </details>

    <div class="editor">
        <div id="line-numbers">1</div>
        <textarea id="code" spellcheck="false" placeholder="Enter dinglebob code..."></textarea>
    </div>

    <button id="run">Run</button>

    <div id="output-container">
        <h3>Output:</h3>
        <div id="output"></div>
    </div>

    <script>
        const codeArea = document.getElementById('code');
        const lineNumbers = document.getElementById('line-numbers');
        const outputDiv = document.getElementById('output');
        const outputContainer = document.getElementById('output-container');
        const DEFAULT_CODE = 'print "Hello World";';

        const updateLines = () => {
            const count = codeArea.value.split('\n').length;
            lineNumbers.innerHTML = Array.from({length: count}, (_, i) => i + 1).join('<br>');
        };

        window.onload = () => {
            codeArea.value = DEFAULT_CODE;
            updateLines();
        };

        codeArea.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = this.selectionStart;
                const end = this.selectionEnd;
                this.value = this.value.substring(0, start) + "    " + this.value.substring(end);
                this.selectionStart = this.selectionEnd = start + 4;
                updateLines(); 
            }
        });

        codeArea.addEventListener('input', updateLines);
        codeArea.addEventListener('scroll', () => {
            lineNumbers.scrollTop = codeArea.scrollTop;
        });

        document.getElementById('run').addEventListener('click', async () => {
            outputContainer.style.display = 'block';
            outputDiv.innerText = "Executing...";

            try {
                const response = await fetch('/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: codeArea.value })
                });
                const data = await response.json();
                outputDiv.innerText = data.output;
                outputContainer.style.display = 'block';
            } catch (e) {
                outputDiv.innerText = "Error: Connection failed";
            }
        });
    </script>
</body>
</html>
